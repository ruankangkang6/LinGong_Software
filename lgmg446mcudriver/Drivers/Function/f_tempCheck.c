/*
 * f_tempCheck..c
 *
 *  Created on: 2024年12月17日
 *      Author: pc
 */
#include "f_public.h"

float g_DerateTorq = 0;            //温度限制扭矩
TEMPLETURE_STRUCT gTemperature = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

static float TemperatureSearch( const int16_t *TableAddr, int16_t iTempModuleAD, int16_t i16Min, int16_t i16Max );//温度查表函数
static float TemperatureSearch1( const int16_t *TableAddr, int16_t iTempModuleAD, int16_t i16Min, int16_t i16Max );//温度查表函数1



#define MIN_IGBT_TEMP       0           //-40
#define MAX_IGBT_TEMP       165         //125
static const int16_t tableIGBTTemp[MAX_IGBT_TEMP + 1] =
{
	4033 ,		 4029 ,		 4024 ,		 4019 ,		 4015 ,		 4010 ,		 4004 ,		 3997 ,		 3991 ,		 3985 ,
	3979 ,		 3971 ,		 3963 ,		 3955 ,		 3947 ,		 3939 ,		 3929 ,		 3918 ,		 3908 ,		 3898 ,
	3888 ,		 3875 ,		 3862 ,		 3850 ,		 3837 ,		 3824 ,		 3809 ,		 3793 ,		 3777 ,		 3762 ,
	3746 ,		 3727 ,		 3708 ,		 3689 ,		 3670 ,		 3651 ,		 3628 ,		 3606 ,		 3583 ,		 3560 ,
	3538 ,		 3512 ,		 3485 ,		 3459 ,		 3433 ,		 3406 ,		 3376 ,		 3346 ,		 3317 ,		 3287 ,
	3257 ,		 3223 ,		 3190 ,		 3156 ,		 3123 ,		 3089 ,		 3053 ,		 3016 ,		 2980 ,		 2943 ,
	2907 ,		 2868 ,		 2829 ,		 2790 ,		 2751 ,		 2713 ,		 2672 ,		 2632 ,		 2591 ,		 2551 ,
	2510 ,		 2469 ,		 2428 ,		 2386 ,		 2345 ,		 2304 ,		 2263 ,		 2222 ,		 2180 ,		 2139 ,
	2098 ,		 2058 ,		 2018 ,		 1978 ,		 1937 ,		 1897 ,		 1859 ,		 1820 ,		 1782 ,		 1743 ,
	1705 ,		 1668 ,		 1632 ,		 1596 ,		 1559 ,		 1523 ,		 1489 ,		 1456 ,		 1422 ,		 1389 ,
	1355 ,		 1324 ,		 1293 ,		 1262 ,		 1232 ,		 1201 ,		 1173 ,		 1144 ,		 1116 ,		 1088 ,
	1060 ,		 1035 ,		 1010 ,		 985 ,		 960 ,		 935 ,		 913 ,		 891 ,		 868 ,		 846 ,
	824 ,		 804 ,		 784 ,		 765 ,		 745 ,		 725 ,		 708 ,		 690 ,		 673 ,		 655 ,
	638 ,		 623 ,		 607 ,		 592 ,		 577 ,		 561 ,		 548 ,		 535 ,		 522 ,		 508 ,
	495 ,		 483 ,		 471 ,		 460 ,		 448 ,		 436 ,		 426 ,		 416 ,		 406 ,		 396 ,
	386 ,		 377 ,		 368 ,		 359 ,		 350 ,		 341 ,		 333 ,		 325 ,		 318 ,		 310 ,
	302 ,		 295 ,		 289 ,		 282 ,		 275 ,		 269

};



#define MIN_MOTOR_TEMP      62          //-50
#define MAX_MOTOR_TEMP      979         //170
#if MOTOR_TEMP_SENSOR == PT1000
static const int16_t Pt1000RtTab[]={	//10bit adc
		-50,	-50,	-50,	-50,	-50,	-49,	-49,	-49,	-49,	-49,	-48,	-48,	-48,	-48,	-48,	-47,	-47,	-47,	-47,	-46,	-46,	-46,	-46,	-46,	-45,	-45,	-45,	-45,	-45,	-44,	-44,	-44,	-44,	-43,	-43,	-43,	-43,	-43,	-42,	-42,	-42,	-42,	-42,	-41,	-41,	-41,	-41,
		-40,	-40,	-40,	-40,	-40,	-39,	-39,	-39,	-39,	-39,	-38,	-38,	-38,	-38,	-37,	-37,	-37,	-37,	-37,	-36,	-36,	-36,	-36,	-35,	-35,	-35,	-35,	-35,	-34,	-34,	-34,	-34,	-33,	-33,	-33,	-33,	-33,	-32,	-32,	-32,	-32,	-31,	-31,	-31,	-31,
		-30,	-30,	-30,	-30,	-30,	-29,	-29,	-29,	-29,	-29,	-28,	-28,	-28,	-28,	-27,	-27,	-27,	-27,	-27,	-26,	-26,	-26,	-26,	-26,	-25,	-25,	-25,	-25,	-24,	-24,	-24,	-24,	-24,	-23,	-23,	-23,	-23,	-22,	-22,	-22,	-22,	-22,	-21,	-21,	-21,	-21,
		-20,	-20,	-20,	-20,	-20,	-19,	-19,	-19,	-19,	-18,	-18,	-18,	-18,	-18,	-17,	-17,	-17,	-17,	-16,	-16,	-16,	-16,	-16,	-15,	-15,	-15,	-15,	-14,	-14,	-14,	-14,	-14,	-13,	-13,	-13,	-13,	-12,	-12,	-12,	-12,	-12,	-11,	-11,	-11,	-11,
		-10,	-10,	-10,	-10,	-10,	-9,	-9,	-9,	-9,	-8,	-8,	-8,	-8,	-8,	-7,	-7,	-7,	-7,	-6,	-6,	-6,	-6,	-6,	-5,	-5,	-5,	-5,	-4,	-4,	-4,	-4,	-3,	-3,	-3,	-3,	-3,	-2,	-2,	-2,	-2,	-1,	-1,	-1,	-1,
		0,	0,	0,	0,	0,	1,	1,	1,	1,	2,	2,	2,	2,	2,	3,	3,	3,	3,	4,	4,	4,	4,	5,	5,	5,	5,	5,	6,	6,	6,	6,	7,	7,	7,	7,	7,	8,	8,	8,	8,	9,	9,	9,	9,
		10,	10,	10,	10,	10,	11,	11,	11,	11,	12,	12,	12,	12,	12,	13,	13,	13,	13,	14,	14,	14,	14,	15,	15,	15,	15,	15,	16,	16,	16,	16,	17,	17,	17,	17,	18,	18,	18,	18,	18,	19,	19,	19,	19,
		20,	20,	20,	20,	20,	21,	21,	21,	21,	22,	22,	22,	22,	23,	23,	23,	23,	24,	24,	24,	24,	24,	25,	25,	25,	25,	26,	26,	26,	26,	27,	27,	27,	27,	28,	28,	28,	28,	29,	29,	29,	29,
		30,	30,	30,	30,	30,	31,	31,	31,	31,	32,	32,	32,	32,	33,	33,	33,	33,	33,	34,	34,	34,	34,	35,	35,	35,	35,	36,	36,	36,	36,	36,	37,	37,	37,	37,	38,	38,	38,	38,	39,	39,	39,	39,
		40,	40,	40,	40,	40,	41,	41,	41,	41,	42,	42,	42,	42,	43,	43,	43,	43,	43,	44,	44,	44,	44,	45,	45,	45,	45,	46,	46,	46,	46,	47,	47,	47,	47,	47,	48,	48,	48,	48,	49,	49,	49,	49,
		50,	50,	50,	50,	50,	51,	51,	51,	51,	52,	52,	52,	52,	53,	53,	53,	53,	54,	54,	54,	54,	55,	55,	55,	55,	56,	56,	56,	56,	57,	57,	57,	57,	57,	58,	58,	58,	58,	59,	59,	59,
		60,	60,	60,	60,	60,	61,	61,	61,	61,	62,	62,	62,	62,	63,	63,	63,	63,	64,	64,	64,	64,	65,	65,	65,	65,	66,	66,	66,	66,	67,	67,	67,	67,	68,	68,	68,	68,	69,	69,	69,	69,
		70,	70,	70,	70,	70,	71,	71,	71,	71,	72,	72,	72,	72,	73,	73,	73,	73,	74,	74,	74,	74,	75,	75,	75,	75,	75,	76,	76,	76,	76,	77,	77,	77,	77,	78,	78,	78,	78,	79,	79,	79,	79,
		80,	80,	80,	80,	80,	81,	81,	81,	81,	82,	82,	82,	82,	83,	83,	83,	83,	84,	84,	84,	84,	85,	85,	85,	85,	86,	86,	86,	86,	87,	87,	87,	87,	88,	88,	88,	88,	89,	89,	89,
		90,	90,	90,	90,	90,	91,	91,	91,	91,	92,	92,	92,	92,	93,	93,	93,	93,	94,	94,	94,	94,	95,	95,	95,	95,	96,	96,	96,	96,	97,	97,	97,	97,	98,	98,	98,	98,	99,	99,	99,
		100,	100,	100,	100,	101,	101,	101,	101,	102,	102,	102,	102,	103,	103,	103,	103,	104,	104,	104,	104,	105,	105,	105,	105,	106,	106,	106,	106,	107,	107,	107,	107,	108,	108,	108,	108,	109,	109,	109,	109,
		110,	110,	110,	110,	111,	111,	111,	111,	112,	112,	112,	112,	113,	113,	113,	113,	114,	114,	114,	114,	115,	115,	115,	115,	116,	116,	116,	116,	117,	117,	117,	117,	118,	118,	118,	118,	119,	119,	119,	119,
		120,	120,	120,	120,	121,	121,	121,	121,	122,	122,	122,	122,	123,	123,	123,	123,	124,	124,	124,	124,	125,	125,	125,	125,	126,	126,	126,	127,	127,	127,	127,	128,	128,	128,	128,	129,	129,	129,
		130,	130,	130,	130,	131,	131,	131,	131,	132,	132,	132,	132,	133,	133,	133,	133,	134,	134,	134,	134,	135,	135,	135,	136,	136,	136,	136,	137,	137,	137,	137,	138,	138,	138,	138,	139,	139,	139,
		140,	140,	140,	140,	141,	141,	141,	141,	142,	142,	142,	142,	143,	143,	143,	143,	144,	144,	144,	144,	145,	145,	145,	145,	146,	146,	146,	146,	147,	147,	147,	147,	148,	148,	148,	148,	149,	149,	149,
		150,	150,	150,	150,	151,	151,	151,	151,	152,	152,	152,	152,	153,	153,	153,	153,	154,	154,	154,	155,	155,	155,	155,	156,	156,	156,	156,	157,	157,	157,	157,	158,	158,	158,	159,	159,	159,	159,
		160,	160,	160,	160,	161,	161,	161,	161,	162,	162,	162,	162,	163,	163,	163,	164,	164,	164,	164,	165,	165,	165,	165,	166,	166,	166,	166,	167,	167,	167,	168,	168,	168,	168,	169,	169,	169,
		170,	170,	170,	170,	171,	171,	171,	171,	172,	172,	172,	172,	173,	173,	173,	174,	174,	174,	174,	175,	175,	175,	175,	176,	176,	176,	176,	177,	177,	177,	178,	178,	178,	178,	179,	179,	179,
		180,
};
#if 0
static const int16_t tableMotorTemp[MAX_MOTOR_TEMP + 1] =
{
    1660,
    1668,   1675,   1683,   1691,   1699,   1707,   1715,   1723,   1730,   1738,
    1746,   1754,   1762,   1770,   1777,   1785,   1793,   1801,   1809,   1816,
    1824,   1832,   1840,   1847,   1855,   1863,   1871,   1878,   1886,   1894,
    1902,   1909,   1917,   1925,   1932,   1940,   1948,   1955,   1963,   1971,
    1979,   1986,   1994,   2001,   2009,   2017,   2024,   2032,   2040,   2047,
    2055,   2063,   2070,   2078,   2085,   2093,   2101,   2108,   2116,   2123,
    2131,   2138,   2146,   2153,   2161,   2169,   2176,   2184,   2191,   2199,
    2206,   2214,   2221,   2229,   2236,   2244,   2251,   2259,   2266,   2274,
    2281,   2289,   2296,   2303,   2311,   2318,   2326,   2333,   2341,   2348,
    2356,   2363,   2370,   2378,   2385,   2393,   2400,   2407,   2415,   2422,
    2429,   2437,   2444,   2452,   2459,   2466,   2474,   2481,   2488,   2496,
    2503,   2510,   2517,   2525,   2532,   2539,   2547,   2554,   2561,   2569,
    2576,   2583,   2590,   2598,   2605,   2612,   2619,   2627,   2634,   2641,
    2648,   2655,   2663,   2670,   2677,   2684,   2691,   2699,   2706,   2713,
    2720,   2727,   2735,   2742,   2749,   2756,   2763,   2770,   2777,   2785,
    2792,   2799,   2806,   2813,   2820,   2827,   2834,   2841,   2849,   2856,
    2863,   2870,   2877,   2884,   2891,   2898,   2905,   2912,   2919,   2926,
    2933,   2940,   2947,   2954,   2961,   2968,   2975,   2982,   2989,   2996,
    3003,   3010,   3017,   3024,   3031,   3038,   3045,   3052,   3059,   3066,
    3073,   3080,   3087,   3094,   3101,   3108,   3115,   3122,   3128,   3135,
    3142,   3149,   3156,   3163,   3170,   3177,   3184,   3190,   3197,   3204,
    3211,   3218,   3225,   3232,   3238,   3245,   3252,   3259,   3266,   3272,
    3279,   3286,   3293,   3300,   3306,   3313,   3320,   3327,   3334,   3340,
    3347,   3354,   3361,   3367,   3374,   3381,   3388,   3394,   3401,   3408,
    3415,   3421,   3428,   3435,   3441,   3448,   3455,   3461,   3468,   3475
};
#endif
#endif


#define MIN_AMB_TEMP        0           //-40
#define MAX_AMB_TEMP        160         //-100
static const int16_t tableAMBTemp[MAX_AMB_TEMP + 1] =
{
	4050,        4047,        4044,        4041,        4037,        4033,        4029,        4025,
	4020,        4015,        4010,        4005,        4000,        3994,        3988,        3981,
	3974,        3967,        3960,        3952,        3944,        3936,        3927,        3918,
	3908,        3898,        3888,        3877,        3866,        3854,        3842,        3829,
	3816,        3803,        3789,        3774,        3759,        3743,        3727,        3710,
	3693,        3675,        3657,        3638,        3618,        3598,        3578,        3556,
	3535,        3512,        3489,        3466,        3442,        3417,        3392,        3366,
	3340,        3313,        3286,        3258,        3229,        3200,        3171,        3141,
	3111,        3080,        3049,        3017,        2986,        2953,        2921,        2888,
	2854,        2821,        2787,        2753,        2718,        2684,        2649,        2614,
	2579,        2544,        2509,        2474,        2438,        2403,        2368,        2332,
	2297,        2262,        2227,        2192,        2157,        2122,        2088,        2053,
	2019,        1985,        1952,        1918,        1885,        1852,        1820,        1787,
	1756,        1724,        1693,        1662,        1631,        1601,        1571,        1542,
	1513,        1484,        1456,        1428,        1401,        1374,        1347,        1321,
	1295,        1270,        1245,        1220,        1196,        1173,        1149,        1126,
	1104,        1082,        1060,        1039,        1018,         998,         978,         958,
	939 ,        920 ,        901,         883,         865,         848,         831,         814,
	797 ,        781 ,        766,         750,         735,         720,         706,         692,
	678 ,        664,         651,         638,         625,         613,         601,         589,
	577

};

/*-40 - 60*/
#define MOTOR_TEMP_LO_MIN	0	//-40
#define MOTOR_TEMP_LO_MAX   100  //60
const int16_t MotorTempLoTable[]={
3723,	3704,	3684,	3663,	3641,	3618,	3595,	3571,	3546,	3520,	3493,	3466,	3437,	3408,	3378,	3347,	3315,	3282,	3249,	3215,	3180,	3145,	3108,	3071,	3034,	2995,	2956,	2917,	2877,	2836,	2795,	2753,	2712,	2669,	2627,	2584,	2541,	2498,	2454,	2411,	2367,	2324,	2280,	2237,	2193,	2150,	2107,	2064,	2021,	1979,	1937,	1895,	1854,	1813,	1772,	1732,	1693,	1654,	1615,	1578,	1540,	1503,	1467,	1431,	1396,	1362,	1328,	1295,	1263,	1231,	1199,	1169,	1139,	1110,	1081,	1053,	1026,	999,	973,	947,	922,	898,	874,	851,	828,	806,	785,	764,	743,	724,	704,	685,	667,	649,	632,	615,	598,	582,	567,	552,	537,
};
/*50 - 170*/
#define MOTOR_TEMP_HI_MIN	0	//50
#define MOTOR_TEMP_HI_MAX   120 //170
const int16_t MotorTempHiTable[]={
2865,	2837,	2809,	2780,	2751,	2722,	2693,	2664,	2635,	2605,	2576,	2546,	2516,	2486,	2456,	2426,	2396,	2366,	2336,	2306,	2276,	2246,	2217,	2187,	2157,	2127,	2098,	2068,	2039,	2010,	1981,	1951,	1923,	1894,	1865,	1837,	1809,	1781,	1754,	1727,	1699,	1672,	1646,	1619,	1593,	1567,	1541,	1516,	1490,	1466,	1441,	1417,	1393,	1369,	1345,	1322,	1299,	1277,	1254,	1232,	1210,	1190,	1169,	1148,	1127,	1107,	1087,	1067,	1048,	1029,	1011,	992,	974,	956,	939,	922,	904,	889,	872,	856,	840,	824,	809,	794,	779,	764,	751,	737,	723,	709,	696,	683,	671,	658,	646,	633,	622,	610,	598,	588,	576,	566,	556,	546,	535,	525,	516,	505,	497,	488,	479,	470,	461,	453,	444,	437,	430,	420,	413,	406,	398,
};
/*-40 - 125*/
#define NTC10K_TEMP_MIN		0	//-40
#define NTC10K_TEMP_MAX   165   //125
const int16_t Ntc10kTempTable[]={
4029,	4025,	4020,	4016,	4011,	4006,	4000,	3995,	3989,	3982,	3976,	3969,	3961,	3953,	3945,	3937,	3927,	3918,	3908,	3897,	3886,	3875,	3863,	3850,	3837,	3823,	3809,	3794,	3779,	3762,	3746,	3728,	3710,	3691,	3671,	3651,	3630,	3608,	3586,	3562,	3538,	3514,	3488,	3462,	3435,	3407,	3378,	3349,	3319,	3288,	3256,	3224,	3191,	3157,	3123,	3088,	3052,	3016,	2979,	2942,	2904,	2865,	2826,	2787,	2747,	2707,	2667,	2626,	2585,	2544,	2502,	2461,	2419,	2377,	2336,	2294,	2252,	2210,	2168,	2127,	2086,	2044,	2004,	1963,	1923,	1883,	1843,	1804,	1765,	1726,	1688,	1651,	1613,	1577,	1541,	1505,	1470,	1436,	1402,	1368,	1336,	1303,	1272,	1241,	1210,	1181,	1152,	1123,	1095,	1067,	1041,	1014,	989,	964,	939,	915,	892,	869,	847,	825,	804,	783,	763,	743,	724,	706,	688,	670,	652,	636,	619,	604,	588,	572,	558,	544,	530,	516,	503,	490,	477,	465,	453,	442,	431,	420,	410,	399,	390,	380,	370,	361,	352,	343,	335,	326,	319,	311,	303,	296,	289,	282,	275,	268,	262,	256,
};
void TemperatureCheck(void)
{
	static uint8 temp_hi_lo;

    //根据采样值查温度值
/*IGBT temperature*/
    //gTemperature.Temp       = TemperatureSearch1( tableIGBTTemp,  gTemperature.TempAD, MIN_IGBT_TEMP,  MAX_IGBT_TEMP ) - 40;
    gTemperature.Temp       = TemperatureSearch1( Ntc10kTempTable,  gTemperature.TempAD, NTC10K_TEMP_MIN,  NTC10K_TEMP_MAX ) - 40;
/*motor temperature*/

    if(temp_hi_lo==0)
    {
    	gTemperature.MotorTemp       = TemperatureSearch1( MotorTempLoTable,  gTemperature.MotorTempAD, MOTOR_TEMP_LO_MIN,  MOTOR_TEMP_LO_MAX ) - 40;
    }
    else
    {
    	gTemperature.MotorTemp       = TemperatureSearch1( MotorTempHiTable,  gTemperature.MotorTempAD, MOTOR_TEMP_HI_MIN,  MOTOR_TEMP_HI_MAX ) + 50;
    }
    gTemperature.MotorTemp2 = gTemperature.MotorTemp;
    if(gTemperature.MotorTemp>=60.0)
	{
    	temp_hi_lo = 1;
    	HAL_GPIO_WritePin(GPIOC, GPIO_PIN_3, GPIO_PIN_SET);
	}
	else if(gTemperature.MotorTemp<=50.0)
	{
		temp_hi_lo = 0;
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_3, GPIO_PIN_RESET);
	}


/*ambient temperature*/
	//gTemperature.AMBTemp    = TemperatureSearch1( tableAMBTemp,  gTemperature.TempAMBAD2, MIN_AMB_TEMP,  MAX_AMB_TEMP ) -40;
	gTemperature.AMBTemp       = TemperatureSearch1( Ntc10kTempTable,  gTemperature.TempAMBAD2, NTC10K_TEMP_MIN,  NTC10K_TEMP_MAX ) - 40;

    TemperatureProtect();   //温度保护
}

/************************************************************
             温度查表函数
************************************************************/
static float TemperatureSearch1( const int16_t *TableAddr, int16_t iTempModuleAD, int16_t i16Min, int16_t i16Max )
{
	int16_t i16Low    =   i16Min;
    int16_t i16Mid    =   0;
    int16_t i16High   =   i16Max;
    int16_t i16Diff   =   0;
    int16_t i16Find   =   0;

    float f32Value = 0;

    if ( iTempModuleAD <= *( TableAddr + i16High -1 ) )
    {
        f32Value = i16Max;
    }
    else if ( iTempModuleAD >= *TableAddr )
    {
        f32Value = i16Min;
    }
    else
    {
        while( i16Low < i16High - 1  && 0 == i16Find )
        {
            i16Mid  = (( i16Low + i16High )>>1);
            i16Diff = iTempModuleAD - *( TableAddr + i16Mid );

            if( 0 == i16Diff )
            {
                i16Find = 1;
            }
            else if( i16Diff < 0 )
            {
                i16Low = i16Mid;
                i16Mid = i16High;

            }
            else
            {
                i16High = i16Mid;
                i16Mid  = i16High;

            }
        }

        if( i16Min == i16Mid )
        {
            i16Low  =   i16Min;
            i16High =   i16Min + 1;
        }
        else if( i16Max - 1 == i16Mid )
        {
            i16Low  =   i16Max - 2;
            i16High =   i16Max - 1;
        }
        else
        {
            if( iTempModuleAD > TableAddr[i16Mid] )
            {
                i16Low  =   i16Mid;
                i16High =   i16Mid + 1;
            }
            else
            {
                i16Low  =   i16Mid - 1;
                i16High =   i16Mid;
            }
        }

        f32Value = ( (float)(iTempModuleAD) - TableAddr[i16Low] )/( TableAddr[i16High] - TableAddr[i16Low] );
        f32Value += i16Low;

    }

    return f32Value;
}


static float TemperatureSearch( const int16_t *TableAddr, int16_t iTempModuleAD, int16_t i16Min, int16_t i16Max )
{
	int16_t i16Low    =   i16Min;
    int16_t i16Mid    =   0;
    int16_t i16High   =   i16Max;
    int16_t i16Diff   =   0;
    int16_t i16Find   =   0;

    float f32Value = 0;

    if ( iTempModuleAD >= *( TableAddr + i16High -1 ) )
    {
        f32Value = i16Max;
    }
    else if ( iTempModuleAD <= *TableAddr )
    {
        f32Value = i16Min;
    }
    else
    {
        while( i16Low < i16High - 1  && 0 == i16Find )
        {
            i16Mid  = (( i16Low + i16High )>>1);
            i16Diff = iTempModuleAD - *( TableAddr + i16Mid );

            if( 0 == i16Diff )
            {
                i16Find = 1;
            }
            else if( i16Diff < 0 )
            {
                i16High = i16Mid;
                i16Mid  = i16High;
            }
            else
            {
                i16Low = i16Mid;
                i16Mid = i16High;
            }
        }

        if( i16Min == i16Mid )
        {
            i16Low  =   i16Min;
            i16High =   i16Min + 1;
        }
        else if( i16Max - 1 == i16Mid )
        {
            i16Low  =   i16Max - 2;
            i16High =   i16Max - 1;
        }
        else
        {
            if( iTempModuleAD > TableAddr[i16Mid] )
            {
                i16Low  =   i16Mid;
                i16High =   i16Mid + 1;
            }
            else
            {
                i16Low  =   i16Mid - 1;
                i16High =   i16Mid;
            }
        }

        f32Value = ( (float)(iTempModuleAD) - TableAddr[i16Low] )/( TableAddr[i16High] - TableAddr[i16Low] );
        f32Value += i16Low;

    }

    return f32Value;
}

